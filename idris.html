<!DOCTYPE html>
<html>
  <head>
  <script src="pdf.js"></script>
  <script src="compatibility.js"></script>
  <script src="slides.js"></script>
<style type="text/css">
#slides {
  width: 640px;
  height: 480px;
  overflow: scroll;
}
#slides > * {
  margin: 0;
}
#player {
  float: left;
}
h1, h3, h4 {
  font-family: serif;
  text-align: center;
}
p {
  font-family: serif;
}
</style>
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #7f7f7f; background-color: #1a1a1a; margin: 0; }
pre * { font-size: 1em; }
.Special { color: #8a2be2; }
.LineNr { color: #552a7b; background-color: #0d0d0d; padding-bottom: 1px; }
.Statement { color: #9b30ff; font-weight: bold; }
.PreProc { color: #1874cd; }
.Type { color: #008b8b; font-weight: bold; }
-->
</style>
  </head>
  <body>

    <h1>Dependently Typed Programming in Idris: A Demo</h1>
    <h3><a href="http://itu.dk/people/drc/">David Raymond Christiansen</a></h3>
    <h4>March 26, 2014</h4>

    <p><a href="http://itu.dk/people/drc/">David Raymond Christiansen</a>, a Ph.D. student at ITU, gives a talk about the <a href="http://www.idris-lang.org">Idris programming language</a> on March 26, 2014, at the <a href="http://www.meetup.com/Haskell-DC/">Haskell DC meetup in Washington, D.C</a>.
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>

    <script>
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '480',
          width: '640',
          videoId: '-CbFj9K9AQg',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      var done = false;
      function onPlayerStateChange(event) {
        if (/*event.data == YT.PlayerState.PLAYING &&*/ !done) {
          stopVideo();
          //setTimeout(stopVideo, 1000);
          //done = true;
        }
      }
      function stopVideo() {
        //document.getElementsByName("snoclist")[0].scrollIntoView();
        setByTime(player.getCurrentTime());
        done = false;
        if (player.getPlayerState() == 1) {
          setTimeout(stopVideo, 1000);
        }
        //player.stopVideo();
      }
    </script>
  <div id="slides">
  <div id="Demo" style="display: none;">
<pre id='vimCodeElement'>
<a name="demo1"></a><span class="LineNr"> 1 </span><span class="Type">module</span> <span class="PreProc">Demo</span>
<span class="LineNr"> 2 </span>
<span class="LineNr"> 3 </span><span class="Statement">%default</span> <span class="Statement">total</span>
<span class="LineNr"> 4 </span>
<a name="demonat"></a><span class="LineNr"> 5 </span><span class="Type">data</span> <span class="PreProc">Nat</span>' <span class="Statement">:</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr"> 6 </span>  <span class="PreProc">Z</span>' <span class="Statement">:</span> <span class="PreProc">Nat</span>'
<span class="LineNr"> 7 </span>  <span class="PreProc">S</span>' <span class="Statement">:</span> <span class="PreProc">Nat</span>' <span class="Statement">-&gt;</span> <span class="PreProc">Nat</span>'
<span class="LineNr"> 8 </span>
<span class="LineNr"> 9 </span><span class="Statement">%name</span> <span class="PreProc">Nat</span>' n<span class="Special">,</span>m<span class="Special">,</span>o
<span class="LineNr">10 </span>
<span class="LineNr">11 </span>plus' <span class="Statement">:</span> <span class="PreProc">Nat</span>' <span class="Statement">-&gt;</span> <span class="PreProc">Nat</span>' <span class="Statement">-&gt;</span> <span class="PreProc">Nat</span>'
<span class="LineNr">12 </span>plus' <span class="PreProc">Z</span>'     m <span class="Statement">=</span> m
<span class="LineNr">13 </span>plus' <span class="Special">(</span><span class="PreProc">S</span>' n<span class="Special">)</span> m <span class="Statement">=</span> <span class="PreProc">S</span>' <span class="Special">(</span>plus' n m<span class="Special">)</span>
<span class="LineNr">14 </span>
<a name="demovect"></a><span class="LineNr">15 </span><span class="Type">data</span> <span class="PreProc">Vect</span>' <span class="Statement">:</span> <span class="PreProc">Nat</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr">16 </span>  <span class="PreProc">Nil</span> <span class="Statement">:</span> <span class="PreProc">Vect</span>' <span class="PreProc">Z</span> a
<span class="LineNr">17 </span>  <span class="Special">(</span><span class="Statement">::</span><span class="Special">)</span> <span class="Statement">:</span> a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span>' n a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span>' <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">)</span> a
<span class="LineNr">18 </span>
<span class="LineNr">19 </span><span class="Statement">%name</span> <span class="PreProc">Vect</span>' xs<span class="Special">,</span>ys<span class="Special">,</span>zs
<span class="LineNr">20 </span>
<span class="LineNr">21 </span>append <span class="Statement">:</span> <span class="PreProc">Vect</span>' n a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span>' m a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span>' <span class="Special">(</span>n <span class="Statement">+</span> m<span class="Special">)</span> a
<span class="LineNr">22 </span>append <span class="PreProc">Nil</span>       ys <span class="Statement">=</span> ys
<span class="LineNr">23 </span>append <span class="Special">(</span>x <span class="Statement">::</span> xs<span class="Special">)</span> ys <span class="Statement">=</span> x <span class="Statement">::</span> <span class="Special">(</span>append xs ys<span class="Special">)</span>
<span class="LineNr">24 </span>
<span class="LineNr">25 </span>zip <span class="Statement">:</span> <span class="PreProc">Vect</span>' n a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span>' n b <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span>' n <span class="Special">(</span>a<span class="Special">,</span> b<span class="Special">)</span>
<span class="LineNr">26 </span>zip <span class="Special">[]</span>        <span class="Special">[]</span>        <span class="Statement">=</span> <span class="Special">[]</span>
<span class="LineNr">27 </span>zip <span class="Special">(</span>x <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Special">(</span>y <span class="Statement">::</span> ys<span class="Special">)</span> <span class="Statement">=</span> <span class="Special">(</span>x<span class="Special">,</span> y<span class="Special">)</span> <span class="Statement">::</span> <span class="Special">(</span>zip xs ys<span class="Special">)</span>
<span class="LineNr">28 </span>
<span class="LineNr">29 </span>take' <span class="Statement">:</span> <span class="Special">(</span>n <span class="Statement">:</span> <span class="PreProc">Nat</span><span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span> <span class="Special">(</span>n <span class="Statement">+</span> m<span class="Special">)</span> a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span> n a
<span class="LineNr">30 </span>take' <span class="PreProc">Z</span>     xs <span class="Statement">=</span> <span class="Special">[]</span>
<span class="LineNr">31 </span>take' <span class="Special">(</span><span class="PreProc">S</span> k<span class="Special">)</span> <span class="Special">(</span>x <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Statement">=</span> x <span class="Statement">::</span> take' k xs
<span class="LineNr">32 </span>
<span class="LineNr">33 </span>drop' <span class="Statement">:</span> <span class="Special">(</span>n <span class="Statement">:</span> <span class="PreProc">Nat</span><span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span> <span class="Special">(</span>n <span class="Statement">+</span> m<span class="Special">)</span> a <span class="Statement">-&gt;</span> <span class="PreProc">Vect</span> m a
<span class="LineNr">34 </span>drop' <span class="PreProc">Z</span> xs <span class="Statement">=</span> xs
<span class="LineNr">35 </span>drop' <span class="Special">(</span><span class="PreProc">S</span> k<span class="Special">)</span> <span class="Special">(</span>x <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Statement">=</span> drop' k xs
<span class="LineNr">36 </span>
<span class="LineNr">37 </span>
<a name="snoclist"></a><span class="LineNr">38 </span><span class="Type">data</span> <span class="PreProc">SnocList</span> <span class="Statement">:</span> <span class="PreProc">List</span> a <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr">39 </span>  <span class="PreProc">SnocNil</span> <span class="Statement">:</span> <span class="PreProc">SnocList</span> <span class="Special">(</span><span class="PreProc">Nil</span> <span class="Special">{</span>a<span class="Statement">=</span>a<span class="Special">})</span>
<span class="LineNr">40 </span>  <span class="PreProc">Snoc</span>    <span class="Statement">:</span> <span class="Special">(</span>xs <span class="Statement">:</span> <span class="PreProc">List</span> a<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="Special">(</span>x <span class="Statement">:</span>a<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">SnocList</span> <span class="Special">(</span>xs <span class="Statement">++</span> <span class="Special">[</span>x<span class="Special">])</span>
<span class="LineNr">41 </span>
<span class="LineNr">42 </span>snocced <span class="Statement">:</span> <span class="Special">(</span>xs <span class="Statement">:</span> <span class="PreProc">List</span> a<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">SnocList</span> xs
<span class="LineNr">43 </span>snocced <span class="Special">[]</span> <span class="Statement">=</span> <span class="PreProc">SnocNil</span>
<span class="LineNr">44 </span>snocced <span class="Special">(</span>x <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Statement">with</span> <span class="Special">(</span>snocced xs<span class="Special">)</span>
<span class="LineNr">45 </span>  snocced <span class="Special">(</span>x <span class="Statement">::</span> <span class="Special">[])</span>          <span class="Statement">|</span> <span class="PreProc">SnocNil</span>     <span class="Statement">=</span> <span class="PreProc">Snoc</span> <span class="Special">[]</span> x
<span class="LineNr">46 </span>  snocced <span class="Special">(</span>x <span class="Statement">::</span> <span class="Special">(</span>ys <span class="Statement">++</span> <span class="Special">[</span>y<span class="Special">]))</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Snoc</span> ys y<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">Snoc</span> <span class="Special">(</span>x <span class="Statement">::</span> ys<span class="Special">)</span> y
<span class="LineNr">47 </span>
<span class="LineNr">48 </span>rot <span class="Statement">:</span> <span class="PreProc">Nat</span> <span class="Statement">-&gt;</span> <span class="PreProc">List</span> a <span class="Statement">-&gt;</span> <span class="PreProc">List</span> a
<span class="LineNr">49 </span>rot <span class="PreProc">Z</span>       xs                        <span class="Statement">=</span> xs
<span class="LineNr">50 </span>rot <span class="Special">(</span><span class="PreProc">S</span> k<span class="Special">)</span>   xs       <span class="Statement">with</span> <span class="Special">(</span>snocced xs<span class="Special">)</span>
<span class="LineNr">51 </span>  rot <span class="Special">(</span><span class="PreProc">S</span> k<span class="Special">)</span> <span class="Special">[]</span>          <span class="Statement">|</span> <span class="PreProc">SnocNil</span>     <span class="Statement">=</span> <span class="Special">[]</span>
<span class="LineNr">52 </span>  rot <span class="Special">(</span><span class="PreProc">S</span> k<span class="Special">)</span> <span class="Special">(</span>ys <span class="Statement">++</span> <span class="Special">[</span>x<span class="Special">])</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Snoc</span> ys x<span class="Special">)</span> <span class="Statement">=</span> rot k <span class="Special">(</span>x<span class="Statement">::</span>ys<span class="Special">)</span>
</pre>
</div>
<div id="AVL" style="display: none;">
<pre id='vimCodeElement'>
<a name="avlmodule"></a><span class="LineNr">  1 </span><span class="Type">module</span> <span class="PreProc">AVL</span>
<span class="LineNr">  2 </span>
<span class="LineNr">  3 </span><span class="Statement">%default</span> <span class="Statement">total</span>
<span class="LineNr">  4 </span><span class="Comment">-------------------------------------------</span>
<span class="LineNr">  5 </span><span class="Comment">-- AVL trees</span>
<span class="LineNr">  6 </span>
<span class="LineNr">  7 </span>
<span class="LineNr">  8 </span>
<span class="LineNr">  9 </span><span class="Type">data</span> <span class="PreProc">Balance</span> <span class="Statement">:</span> <span class="PreProc">Nat</span> <span class="Statement">-&gt;</span> <span class="PreProc">Nat</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr"> 10 </span>  <span class="PreProc">LeftLeaning</span>  <span class="Statement">:</span> <span class="PreProc">Balance</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">)</span> n
<span class="LineNr"> 11 </span>  <span class="PreProc">RightLeaning</span> <span class="Statement">:</span> <span class="PreProc">Balance</span> n <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">)</span>
<span class="LineNr"> 12 </span>  <span class="PreProc">Balanced</span>     <span class="Statement">:</span> <span class="PreProc">Balance</span> n n
<span class="LineNr"> 13 </span>
<span class="LineNr"> 14 </span><span class="Statement">%name</span> <span class="PreProc">Balance</span> b<span class="Special">,</span> bal
<span class="LineNr"> 15 </span>
<span class="LineNr"> 16 </span>
<span class="LineNr"> 17 </span><span class="Statement">total</span>
<span class="LineNr"> 18 </span>height <span class="Statement">:</span> <span class="PreProc">Balance</span> n m <span class="Statement">-&gt;</span> <span class="PreProc">Nat</span>
<span class="LineNr"> 19 </span>height <span class="Special">(</span><span class="PreProc">LeftLeaning</span> <span class="Special">{</span>n<span class="Special">})</span> <span class="Statement">=</span> <span class="PreProc">S</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">)</span>
<span class="LineNr"> 20 </span>height <span class="Special">(</span><span class="PreProc">RightLeaning</span> <span class="Special">{</span>n<span class="Special">})</span> <span class="Statement">=</span> <span class="PreProc">S</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">)</span>
<span class="LineNr"> 21 </span>height <span class="Special">{</span>n<span class="Special">}</span> <span class="Special">(</span><span class="PreProc">Balanced</span> <span class="Special">{</span>n<span class="Special">})</span> <span class="Statement">=</span> <span class="PreProc">S</span> n
<span class="LineNr"> 22 </span>
<span class="LineNr"> 23 </span>
<span class="LineNr"> 24 </span><span class="Type">data</span> <span class="PreProc">Tree</span> <span class="Statement">:</span> <span class="PreProc">Nat</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr"> 25 </span>  <span class="PreProc">Empty</span> <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">0</span> k v
<span class="LineNr"> 26 </span>  <span class="PreProc">Node</span> <span class="Statement">:</span> <span class="Special">(</span>l <span class="Statement">:</span> <span class="PreProc">Tree</span> n k v<span class="Special">)</span> <span class="Statement">-&gt;</span>
<span class="LineNr"> 27 </span>         <span class="Special">(</span>key <span class="Statement">:</span> k<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="Special">(</span>val <span class="Statement">:</span> v<span class="Special">)</span> <span class="Statement">-&gt;</span>
<span class="LineNr"> 28 </span>         <span class="Special">(</span>r <span class="Statement">:</span> <span class="PreProc">Tree</span> m k v<span class="Special">)</span> <span class="Statement">-&gt;</span>
<span class="LineNr"> 29 </span>         <span class="Special">(</span>b <span class="Statement">:</span> <span class="PreProc">Balance</span> n m<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Tree</span> <span class="Special">(</span>height b<span class="Special">)</span> k v
<span class="LineNr"> 30 </span>
<span class="LineNr"> 31 </span><span class="Statement">%name</span> <span class="PreProc">Tree</span> t<span class="Special">,</span> tree
<span class="LineNr"> 32 </span>
<span class="LineNr"> 33 </span>
<span class="LineNr"> 34 </span>
<span class="LineNr"> 35 </span>
<span class="LineNr"> 36 </span><span class="Comment">-- Bad tree:</span>
<span class="LineNr"> 37 </span><span class="Comment">-- Node Empty 0 &quot;0&quot; (Node Empty 1 &quot;1&quot; (Node Empty 2 &quot;2&quot; Empty RightLeaning) RightLeaning) RightLeaning</span>
<span class="LineNr"> 38 </span>
<a name="avllookup"></a><span class="LineNr"> 39 </span>lookup <span class="Statement">:</span> <span class="Special">(</span><span class="PreProc">Ord</span> k<span class="Special">)</span> <span class="Statement">=&gt;</span> k <span class="Statement">-&gt;</span> <span class="PreProc">Tree</span> n k v <span class="Statement">-&gt;</span> <span class="PreProc">Maybe</span> v
<span class="LineNr"> 40 </span>lookup x <span class="PreProc">Empty</span> <span class="Statement">=</span> <span class="PreProc">Nothing</span>
<span class="LineNr"> 41 </span>lookup x <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span> <span class="Statement">=</span>
<span class="LineNr"> 42 </span>  <span class="Statement">case</span> compare x key <span class="Statement">of</span>
<span class="LineNr"> 43 </span>    <span class="PreProc">LT</span> <span class="Statement">=&gt;</span> lookup x l
<span class="LineNr"> 44 </span>    <span class="PreProc">EQ</span> <span class="Statement">=&gt;</span> <span class="PreProc">Just</span> val
<span class="LineNr"> 45 </span>    <span class="PreProc">GT</span> <span class="Statement">=&gt;</span> lookup x r
<span class="LineNr"> 46 </span>
<span class="LineNr"> 47 </span>
<span class="LineNr"> 48 </span>
<span class="LineNr"> 49 </span>
<span class="LineNr"> 50 </span>
<span class="LineNr"> 51 </span>
<span class="LineNr"> 52 </span><span class="Type">data</span> <span class="PreProc">InsertRes</span> <span class="Statement">:</span> <span class="PreProc">Nat</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr"> 53 </span>  <span class="PreProc">Flat</span> <span class="Statement">:</span> <span class="PreProc">Tree</span> n k v <span class="Statement">-&gt;</span> <span class="PreProc">InsertRes</span> n k v
<span class="LineNr"> 54 </span>  <span class="PreProc">Taller</span> <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">)</span> k v <span class="Statement">-&gt;</span> <span class="PreProc">InsertRes</span> n k v
<span class="LineNr"> 55 </span>
<span class="LineNr"> 56 </span><span class="Statement">%name</span> <span class="PreProc">InsertRes</span> res<span class="Special">,</span> r
<span class="LineNr"> 57 </span>
<span class="LineNr"> 58 </span>
<a name="avlrotate"></a><span class="LineNr"> 59 </span>rotLeft <span class="Statement">:</span> <span class="PreProc">Tree</span> n k v <span class="Statement">-&gt;</span> k <span class="Statement">-&gt;</span> v <span class="Statement">-&gt;</span> <span class="PreProc">Tree</span> <span class="Special">(</span><span class="PreProc">S</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">))</span> k v <span class="Statement">-&gt;</span> <span class="PreProc">InsertRes</span> <span class="Special">(</span><span class="PreProc">S</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">))</span> k v
<span class="LineNr"> 60 </span>
<span class="LineNr"> 61 </span><span class="Comment">-- Impossible because Empty has depth 0 and we know the depth is at least 2 from the type</span>
<span class="LineNr"> 62 </span>rotLeft l key val <span class="PreProc">Empty</span> <span class="Statement">impossible</span>
<span class="LineNr"> 63 </span>
<span class="LineNr"> 64 </span>rotLeft l key val <span class="Special">(</span><span class="PreProc">Node</span> rl key' val' rr <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="Statement">=</span>
<span class="LineNr"> 65 </span>  <span class="PreProc">Taller</span> <span class="Statement">$</span> <span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> l key val rl <span class="PreProc">RightLeaning</span><span class="Special">)</span> key' val' rr <span class="PreProc">LeftLeaning</span>
<span class="LineNr"> 66 </span>
<span class="LineNr"> 67 </span>rotLeft l key val <span class="Special">(</span><span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> rll key'' val'' rlr <span class="PreProc">LeftLeaning</span><span class="Special">)</span> key' val' rr <span class="PreProc">LeftLeaning</span><span class="Special">)</span> <span class="Statement">=</span>
<span class="LineNr"> 68 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> rll key'' val'' <span class="Special">(</span><span class="PreProc">Node</span> rlr key' val' rr <span class="PreProc">RightLeaning</span><span class="Special">)</span> <span class="PreProc">RightLeaning</span>
<span class="LineNr"> 69 </span>
<span class="LineNr"> 70 </span>rotLeft l key val <span class="Special">(</span><span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> rll key'' val'' rlr <span class="PreProc">RightLeaning</span><span class="Special">)</span> key' val' rr <span class="PreProc">LeftLeaning</span><span class="Special">)</span> <span class="Statement">=</span>
<span class="LineNr"> 71 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> l key val rll <span class="PreProc">LeftLeaning</span><span class="Special">)</span> key'' val'' <span class="Special">(</span><span class="PreProc">Node</span> rlr key' val' rr <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="PreProc">Balanced</span>
<span class="LineNr"> 72 </span>
<span class="LineNr"> 73 </span>rotLeft l key val <span class="Special">(</span><span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> rll key'' val'' rlr  <span class="PreProc">Balanced</span><span class="Special">)</span> key' val' rr <span class="PreProc">LeftLeaning</span><span class="Special">)</span> <span class="Statement">=</span>
<span class="LineNr"> 74 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> l key val rll <span class="PreProc">Balanced</span><span class="Special">)</span> key'' val'' <span class="Special">(</span><span class="PreProc">Node</span> rlr key' val' rlr <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="PreProc">Balanced</span>
<span class="LineNr"> 75 </span>
<span class="LineNr"> 76 </span>rotLeft l key val <span class="Special">(</span><span class="PreProc">Node</span> rl key' val' rr <span class="PreProc">RightLeaning</span><span class="Special">)</span> <span class="Statement">=</span>
<span class="LineNr"> 77 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span>  <span class="Special">(</span><span class="PreProc">Node</span>  l key val rl <span class="PreProc">Balanced</span><span class="Special">)</span> key' val' rr <span class="PreProc">Balanced</span>
<span class="LineNr"> 78 </span>
<span class="LineNr"> 79 </span>
<span class="LineNr"> 80 </span>
<span class="LineNr"> 81 </span>rotRight <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Special">(</span><span class="PreProc">S</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">))</span> k v <span class="Statement">-&gt;</span> k <span class="Statement">-&gt;</span> v <span class="Statement">-&gt;</span> <span class="PreProc">Tree</span> n k v <span class="Statement">-&gt;</span> <span class="PreProc">InsertRes</span> <span class="Special">(</span><span class="PreProc">S</span> <span class="Special">(</span><span class="PreProc">S</span> n<span class="Special">))</span> k v
<span class="LineNr"> 82 </span>rotRight <span class="PreProc">Empty</span> key val r <span class="Statement">impossible</span>
<span class="LineNr"> 83 </span>
<span class="LineNr"> 84 </span>rotRight <span class="Special">(</span><span class="PreProc">Node</span> ll key val <span class="Special">(</span><span class="PreProc">Node</span> lrl key' val' lrr <span class="PreProc">RightLeaning</span><span class="Special">)</span> <span class="PreProc">RightLeaning</span><span class="Special">)</span> key'' val'' r <span class="Statement">=</span>
<span class="LineNr"> 85 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> ll key val lrl <span class="PreProc">LeftLeaning</span><span class="Special">)</span> key' val' <span class="Special">(</span><span class="PreProc">Node</span> lrr key'' val'' r <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="PreProc">Balanced</span>
<span class="LineNr"> 86 </span>
<span class="LineNr"> 87 </span>rotRight <span class="Special">(</span><span class="PreProc">Node</span> ll key val <span class="Special">(</span><span class="PreProc">Node</span> lrl key' val' lrr <span class="PreProc">LeftLeaning</span><span class="Special">)</span> <span class="PreProc">RightLeaning</span><span class="Special">)</span> key'' val'' r <span class="Statement">=</span>
<span class="LineNr"> 88 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> ll key val lrl <span class="PreProc">Balanced</span><span class="Special">)</span> key' val' <span class="Special">(</span><span class="PreProc">Node</span> lrr key'' val'' r <span class="PreProc">RightLeaning</span><span class="Special">)</span> <span class="PreProc">Balanced</span>
<span class="LineNr"> 89 </span>
<span class="LineNr"> 90 </span>rotRight <span class="Special">(</span><span class="PreProc">Node</span> ll key' val' lr <span class="PreProc">Balanced</span><span class="Special">)</span> key val r <span class="Statement">=</span>
<span class="LineNr"> 91 </span>  <span class="PreProc">Taller</span> <span class="Statement">$</span> <span class="PreProc">Node</span> ll key' val' <span class="Special">(</span><span class="PreProc">Node</span> lr key val r <span class="PreProc">LeftLeaning</span><span class="Special">)</span> <span class="PreProc">RightLeaning</span>
<span class="LineNr"> 92 </span>
<span class="LineNr"> 93 </span>rotRight <span class="Special">(</span><span class="PreProc">Node</span> ll key' val' lr <span class="PreProc">LeftLeaning</span><span class="Special">)</span> key val r <span class="Statement">=</span>
<span class="LineNr"> 94 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> ll key' val' <span class="Special">(</span><span class="PreProc">Node</span> lr key val r <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="PreProc">Balanced</span>
<span class="LineNr"> 95 </span>
<span class="LineNr"> 96 </span>rotRight <span class="Special">(</span><span class="PreProc">Node</span> ll key' val' <span class="Special">(</span><span class="PreProc">Node</span> lrl key'' val'' lrr <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="PreProc">RightLeaning</span><span class="Special">)</span> key val r <span class="Statement">=</span>
<span class="LineNr"> 97 </span>  <span class="PreProc">Flat</span> <span class="Statement">$</span> <span class="PreProc">Node</span> <span class="Special">(</span><span class="PreProc">Node</span> ll key' val' lrl <span class="PreProc">Balanced</span><span class="Special">)</span> key'' val'' <span class="Special">(</span><span class="PreProc">Node</span> lrr key val r <span class="PreProc">Balanced</span><span class="Special">)</span> <span class="PreProc">Balanced</span>
<span class="LineNr"> 98 </span>
<span class="LineNr"> 99 </span>
<a name="avlinsert"></a><span class="LineNr">100 </span>insert <span class="Statement">:</span> <span class="Special">(</span><span class="PreProc">Ord</span> k<span class="Special">)</span> <span class="Statement">=&gt;</span> k <span class="Statement">-&gt;</span> v <span class="Statement">-&gt;</span> <span class="Special">(</span>t <span class="Statement">:</span> <span class="PreProc">Tree</span> n k v<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">InsertRes</span> n k v
<span class="LineNr">101 </span>insert newKey newVal <span class="PreProc">Empty</span> <span class="Statement">=</span> <span class="PreProc">Taller</span> <span class="Special">(</span><span class="PreProc">Node</span> <span class="PreProc">Empty</span> newKey newVal <span class="PreProc">Empty</span> <span class="PreProc">Balanced</span><span class="Special">)</span>
<span class="LineNr">102 </span>insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val  r b<span class="Special">)</span> <span class="Statement">with</span> <span class="Special">(</span>compare newKey key<span class="Special">)</span>
<span class="LineNr">103 </span>  insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span> <span class="Statement">|</span> <span class="PreProc">EQ</span> <span class="Statement">=</span> <span class="PreProc">Flat</span> <span class="Special">(</span><span class="PreProc">Node</span> l newKey newVal r b<span class="Special">)</span>
<span class="LineNr">104 </span>  insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span> <span class="Statement">|</span> <span class="PreProc">LT</span> <span class="Statement">with</span> <span class="Special">(</span>insert newKey newVal l<span class="Special">)</span>
<span class="LineNr">105 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span>            <span class="Statement">|</span> <span class="PreProc">LT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Flat</span> l'<span class="Special">)</span>   <span class="Statement">=</span> <span class="PreProc">Flat</span> <span class="Special">(</span><span class="PreProc">Node</span> l' key val r b<span class="Special">)</span>
<span class="LineNr">106 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r <span class="PreProc">LeftLeaning</span><span class="Special">)</span>  <span class="Statement">|</span> <span class="PreProc">LT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> l'<span class="Special">)</span> <span class="Statement">=</span> rotRight l' key val r
<span class="LineNr">107 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r <span class="PreProc">Balanced</span><span class="Special">)</span>     <span class="Statement">|</span> <span class="PreProc">LT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> l'<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">Taller</span> <span class="Special">(</span><span class="PreProc">Node</span> l' key val r <span class="PreProc">LeftLeaning</span><span class="Special">)</span>
<span class="LineNr">108 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r <span class="PreProc">RightLeaning</span><span class="Special">)</span> <span class="Statement">|</span> <span class="PreProc">LT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> l'<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">Flat</span> <span class="Special">(</span><span class="PreProc">Node</span> l' key val r <span class="PreProc">Balanced</span><span class="Special">)</span>
<span class="LineNr">109 </span>  insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span> <span class="Statement">|</span> <span class="PreProc">GT</span> <span class="Statement">with</span> <span class="Special">(</span>insert newKey newVal r<span class="Special">)</span>
<span class="LineNr">110 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span>            <span class="Statement">|</span> <span class="PreProc">GT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Flat</span> r'<span class="Special">)</span>   <span class="Statement">=</span> <span class="PreProc">Flat</span> <span class="Special">(</span><span class="PreProc">Node</span> l key val r' b<span class="Special">)</span>
<span class="LineNr">111 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r <span class="PreProc">LeftLeaning</span><span class="Special">)</span>  <span class="Statement">|</span> <span class="PreProc">GT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> r'<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">Flat</span> <span class="Special">(</span><span class="PreProc">Node</span> l key val r' <span class="PreProc">Balanced</span><span class="Special">)</span>
<span class="LineNr">112 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r <span class="PreProc">Balanced</span><span class="Special">)</span>     <span class="Statement">|</span> <span class="PreProc">GT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> r'<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">Taller</span> <span class="Special">(</span><span class="PreProc">Node</span> l key val r' <span class="PreProc">RightLeaning</span><span class="Special">)</span>
<span class="LineNr">113 </span>    insert newKey newVal <span class="Special">(</span><span class="PreProc">Node</span> l key val r <span class="PreProc">RightLeaning</span><span class="Special">)</span> <span class="Statement">|</span> <span class="PreProc">GT</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> r'<span class="Special">)</span> <span class="Statement">=</span> rotLeft l key val r'
<span class="LineNr">114 </span>
<span class="LineNr">115 </span>
<a name="avlfromlist"></a><span class="LineNr">116 </span>fromList <span class="Statement">:</span> <span class="PreProc">Ord</span> k <span class="Statement">=&gt;</span> <span class="PreProc">List</span> <span class="Special">(</span>k<span class="Special">,</span> v<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="Special">(</span>n <span class="Statement">:</span> <span class="PreProc">Nat</span> <span class="Statement">**</span> <span class="PreProc">Tree</span> n k v<span class="Special">)</span>
<span class="LineNr">117 </span>fromList <span class="Special">[]</span> <span class="Statement">=</span> <span class="Special">(</span><span class="Constant">0</span> <span class="Statement">**</span> <span class="PreProc">Empty</span><span class="Special">)</span>
<span class="LineNr">118 </span>fromList <span class="Special">((</span>k<span class="Special">,</span> v<span class="Special">)</span> <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Statement">with</span> <span class="Special">(</span>insert k v <span class="Special">(</span>getProof <span class="Special">(</span><span class="PreProc">AVL</span><span class="Statement">.</span>fromList xs<span class="Special">)))</span>
<span class="LineNr">119 </span>  fromList <span class="Special">((</span>k<span class="Special">,</span> v<span class="Special">)</span> <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Flat</span> x<span class="Special">)</span> <span class="Statement">=</span> <span class="Special">(</span><span class="Statement">_</span> <span class="Statement">**</span> x<span class="Special">)</span>
<span class="LineNr">120 </span>  fromList <span class="Special">((</span>k<span class="Special">,</span> v<span class="Special">)</span> <span class="Statement">::</span> xs<span class="Special">)</span> <span class="Statement">|</span> <span class="Special">(</span><span class="PreProc">Taller</span> x<span class="Special">)</span> <span class="Statement">=</span> <span class="Special">(</span><span class="Statement">_</span> <span class="Statement">**</span> x<span class="Special">)</span>
<span class="LineNr">121 </span>
<span class="LineNr">122 </span>
<span class="LineNr">123 </span>flatten <span class="Statement">:</span> <span class="PreProc">Tree</span> n k v <span class="Statement">-&gt;</span> <span class="PreProc">List</span> <span class="Special">(</span>k<span class="Special">,</span> v<span class="Special">)</span>
<span class="LineNr">124 </span>flatten <span class="PreProc">Empty</span> <span class="Statement">=</span> <span class="Special">[]</span>
<span class="LineNr">125 </span>flatten <span class="Special">(</span><span class="PreProc">Node</span> l key val r b<span class="Special">)</span> <span class="Statement">=</span> flatten l <span class="Statement">++</span> <span class="Special">[(</span>key<span class="Special">,</span> val<span class="Special">)]</span> <span class="Statement">++</span> flatten r
<span class="LineNr">126 </span>
<span class="LineNr">127 </span>
<span class="LineNr">128 </span>tree1 <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">1</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span>
<span class="LineNr">129 </span>tree1 <span class="Statement">=</span> <span class="PreProc">Node</span> <span class="PreProc">Empty</span> <span class="Constant">0</span> <span class="Constant">0</span> <span class="PreProc">Empty</span> <span class="Special">(</span><span class="PreProc">Balanced</span> <span class="Special">{</span>n <span class="Statement">=</span> <span class="Constant">0</span><span class="Special">})</span>
<span class="LineNr">130 </span>
<span class="LineNr">131 </span>
<span class="LineNr">132 </span>
<span class="LineNr">133 </span>
<span class="LineNr">134 </span>test <span class="Statement">:</span> <span class="PreProc">InsertRes</span> <span class="Constant">3</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span>
<span class="LineNr">135 </span>test <span class="Statement">=</span>
<span class="LineNr">136 </span>  <span class="Statement">let</span> key <span class="Statement">:</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Constant">0</span> <span class="Statement">in</span> <span class="Statement">let</span> key' <span class="Statement">:</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Constant">0</span> <span class="Statement">in</span> <span class="Statement">let</span> key'' <span class="Statement">:</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Constant">0</span> <span class="Statement">in</span>
<span class="LineNr">137 </span>  <span class="Statement">let</span> val <span class="Statement">:</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Constant">0</span> <span class="Statement">in</span> <span class="Statement">let</span> val' <span class="Statement">:</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Constant">0</span> <span class="Statement">in</span> <span class="Statement">let</span> val'' <span class="Statement">:</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Constant">0</span> <span class="Statement">in</span>
<span class="LineNr">138 </span>  <span class="Statement">let</span> l <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">1</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span> <span class="Statement">=</span> tree1 <span class="Statement">in</span>
<span class="LineNr">139 </span>  <span class="Statement">let</span> rll <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">1</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span> <span class="Statement">=</span> tree1 <span class="Statement">in</span>
<span class="LineNr">140 </span>  <span class="Statement">let</span> rlr <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">0</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="PreProc">Empty</span> <span class="Statement">in</span>
<span class="LineNr">141 </span>  <span class="Statement">let</span> rr <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">1</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span> <span class="Statement">=</span> tree1 <span class="Statement">in</span>
<span class="LineNr">142 </span>  <span class="Statement">let</span> rl <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">2</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="PreProc">Node</span> rll key'' val'' rlr <span class="PreProc">LeftLeaning</span> <span class="Statement">in</span>
<span class="LineNr">143 </span>  <span class="Statement">let</span> r <span class="Statement">:</span> <span class="PreProc">Tree</span> <span class="Constant">3</span> <span class="PreProc">Int</span> <span class="PreProc">Int</span> <span class="Statement">=</span> <span class="Special">(</span><span class="PreProc">Node</span> rl key' val' rr <span class="Special">(</span>the <span class="Special">(</span><span class="PreProc">Balance</span> <span class="Constant">2</span> <span class="Constant">1</span><span class="Special">)</span> <span class="PreProc">LeftLeaning</span><span class="Special">))</span> <span class="Statement">in</span>
<span class="LineNr">144 </span>  <span class="Statement">let</span> res <span class="Statement">=</span> rotLeft l <span class="Constant">0</span> <span class="Constant">0</span> r <span class="Statement">in</span>
<span class="LineNr">145 </span>  res
<span class="LineNr">146 </span>
</pre>
</div>
<div id="Universes" style="display: none;">
<pre id='vimCodeElement'>
<a name="universesmodule"></a><span class="LineNr"> 1 </span><span class="Type">module</span> <span class="PreProc">Universes</span>
<span class="LineNr"> 2 </span>
<span class="LineNr"> 3 </span><span class="Statement">%default</span> <span class="Statement">total</span>
<span class="LineNr"> 4 </span>
<span class="LineNr"> 5 </span><span class="Type">data</span> <span class="PreProc">Sizable</span> <span class="Statement">=</span> <span class="PreProc">INT</span> <span class="Statement">|</span> <span class="PreProc">LIST</span> <span class="PreProc">Sizable</span> <span class="Statement">|</span> <span class="PreProc">EITHER</span> <span class="PreProc">Sizable</span> <span class="PreProc">Sizable</span>
<span class="LineNr"> 6 </span>
<span class="LineNr"> 7 </span>interp <span class="Statement">:</span> <span class="PreProc">Sizable</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span>
<span class="LineNr"> 8 </span>interp <span class="PreProc">INT</span> <span class="Statement">=</span> <span class="PreProc">Int</span>
<span class="LineNr"> 9 </span>interp <span class="Special">(</span><span class="PreProc">LIST</span> x<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">List</span> <span class="Special">(</span>interp x<span class="Special">)</span>
<span class="LineNr">10 </span>interp <span class="Special">(</span><span class="PreProc">EITHER</span> x y<span class="Special">)</span> <span class="Statement">=</span> <span class="PreProc">Either</span> <span class="Special">(</span>interp x<span class="Special">)</span> <span class="Special">(</span>interp y<span class="Special">)</span>
<span class="LineNr">11 </span>
<span class="LineNr">12 </span>
<span class="LineNr">13 </span>size <span class="Statement">:</span> <span class="Special">(</span>t <span class="Statement">:</span> <span class="PreProc">Sizable</span><span class="Special">)</span> <span class="Statement">-&gt;</span> interp t <span class="Statement">-&gt;</span> <span class="PreProc">Int</span>
<span class="LineNr">14 </span>size <span class="PreProc">INT</span> x <span class="Statement">=</span> x
<span class="LineNr">15 </span>size <span class="Special">(</span><span class="PreProc">LIST</span> y<span class="Special">)</span> xs <span class="Statement">=</span> sum <span class="Special">(</span>map <span class="Special">(</span>size y<span class="Special">)</span> xs<span class="Special">)</span>
<span class="LineNr">16 </span>size <span class="Special">(</span><span class="PreProc">EITHER</span> y z<span class="Special">)</span> <span class="Special">(</span><span class="PreProc">Left</span> x<span class="Special">)</span> <span class="Statement">=</span> <span class="Constant">1</span> <span class="Statement">+</span> size y x
<span class="LineNr">17 </span>size <span class="Special">(</span><span class="PreProc">EITHER</span> y z<span class="Special">)</span> <span class="Special">(</span><span class="PreProc">Right</span> x<span class="Special">)</span> <span class="Statement">=</span> <span class="Constant">1</span> <span class="Statement">+</span> size z x
<span class="LineNr">18 </span>
</pre>
</div>
<div id="Interpreter" style="display: none;">
<pre id='vimCodeElement'>
<a name="interpretermodule"></a><span class="LineNr"> 1 </span><span class="Type">module</span> <span class="PreProc">Interpreter</span>
<span class="LineNr"> 2 </span>
<span class="LineNr"> 3 </span><span class="Statement">%default</span> <span class="Statement">total</span>
<span class="LineNr"> 4 </span>
<span class="LineNr"> 5 </span><span class="PreProc">infixr</span> <span class="Constant">6</span> <span class="Statement">==&gt;</span>
<span class="LineNr"> 6 </span>
<span class="LineNr"> 7 </span><span class="Type">data</span> <span class="PreProc">Ty</span> <span class="Statement">=</span> <span class="PreProc">BOOL</span> <span class="Statement">|</span> <span class="Special">(</span><span class="Statement">==&gt;</span><span class="Special">)</span> <span class="PreProc">Ty</span> <span class="PreProc">Ty</span>
<span class="LineNr"> 8 </span>
<span class="LineNr"> 9 </span><span class="Statement">%name</span> <span class="PreProc">Ty</span> t<span class="Special">,</span>u
<span class="LineNr">10 </span>
<span class="LineNr">11 </span>typeOf <span class="Statement">:</span> <span class="PreProc">Ty</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span>
<span class="LineNr">12 </span>typeOf <span class="PreProc">BOOL</span> <span class="Statement">=</span> <span class="PreProc">Bool</span>
<span class="LineNr">13 </span>typeOf <span class="Special">(</span>t <span class="Statement">==&gt;</span> u<span class="Special">)</span> <span class="Statement">=</span> typeOf t <span class="Statement">-&gt;</span> typeOf u
<span class="LineNr">14 </span>
<a name="interpreterlang"></a><span class="LineNr">15 </span><span class="Statement">using</span> <span class="Special">(</span>n <span class="Statement">:</span> <span class="PreProc">Nat</span><span class="Special">,</span> ctxt <span class="Statement">:</span> <span class="PreProc">Vect</span> n <span class="PreProc">Ty</span><span class="Special">)</span>
<span class="LineNr">16 </span>  <span class="Type">data</span> <span class="PreProc">Term</span> <span class="Statement">:</span> <span class="PreProc">Vect</span> n <span class="PreProc">Ty</span> <span class="Statement">-&gt;</span> <span class="PreProc">Ty</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr">17 </span>    <span class="PreProc">T</span> <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="PreProc">BOOL</span>
<span class="LineNr">18 </span>    <span class="PreProc">F</span> <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="PreProc">BOOL</span>
<span class="LineNr">19 </span>    <span class="PreProc">IF</span> <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="PreProc">BOOL</span> <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt t <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt t <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt t
<span class="LineNr">20 </span>
<span class="LineNr">21 </span>    <span class="PreProc">App</span> <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="Special">(</span>t <span class="Statement">==&gt;</span> u<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt t <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt u
<span class="LineNr">22 </span>    <span class="PreProc">Lam</span> <span class="Statement">:</span> <span class="PreProc">Term</span> <span class="Special">(</span>t<span class="Statement">::</span>ctxt<span class="Special">)</span> u <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt <span class="Special">(</span>t <span class="Statement">==&gt;</span> u<span class="Special">)</span>
<span class="LineNr">23 </span>    <span class="PreProc">Var</span> <span class="Statement">:</span> <span class="Special">(</span>i <span class="Statement">:</span> <span class="PreProc">Fin</span> n<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="PreProc">Term</span> ctxt <span class="Special">(</span>index i ctxt<span class="Special">)</span>
<span class="LineNr">24 </span>
<span class="LineNr">25 </span>  <span class="Statement">%name</span> <span class="PreProc">Term</span> tm<span class="Special">,</span> tm'<span class="Special">,</span> tm''
<span class="LineNr">26 </span>
<span class="LineNr">27 </span>  not <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="Special">(</span><span class="PreProc">BOOL</span> <span class="Statement">==&gt;</span> <span class="PreProc">BOOL</span><span class="Special">)</span>
<span class="LineNr">28 </span>  not <span class="Statement">=</span> <span class="PreProc">Lam</span> <span class="Statement">$</span> <span class="PreProc">IF</span> <span class="Special">(</span><span class="PreProc">Var</span> <span class="Constant">0</span><span class="Special">)</span> <span class="PreProc">F</span> <span class="PreProc">T</span>
<span class="LineNr">29 </span>
<span class="LineNr">30 </span>  choose <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="Special">(</span><span class="PreProc">BOOL</span> <span class="Statement">==&gt;</span> <span class="PreProc">BOOL</span> <span class="Statement">==&gt;</span> <span class="PreProc">BOOL</span> <span class="Statement">==&gt;</span> <span class="PreProc">BOOL</span><span class="Special">)</span>
<span class="LineNr">31 </span>  choose <span class="Statement">=</span> <span class="PreProc">Lam</span> <span class="Statement">$</span> <span class="PreProc">Lam</span> <span class="Statement">$</span> <span class="PreProc">Lam</span> <span class="Statement">$</span> <span class="PreProc">IF</span> <span class="Special">(</span><span class="PreProc">Var</span> <span class="Constant">2</span><span class="Special">)</span> <span class="Special">(</span><span class="PreProc">Var</span> <span class="Constant">1</span><span class="Special">)</span> <span class="Special">(</span><span class="PreProc">Var</span> <span class="Constant">0</span><span class="Special">)</span>
<span class="LineNr">32 </span>
<span class="LineNr">33 </span>  not' <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt <span class="Special">(</span><span class="PreProc">BOOL</span> <span class="Statement">==&gt;</span> <span class="PreProc">BOOL</span><span class="Special">)</span>
<span class="LineNr">34 </span>  not' <span class="Statement">=</span> <span class="PreProc">Lam</span> <span class="Special">(</span><span class="PreProc">App</span> <span class="Special">(</span><span class="PreProc">App</span> <span class="Special">(</span><span class="PreProc">App</span> choose <span class="Special">(</span><span class="PreProc">Var</span> <span class="Constant">0</span><span class="Special">))</span> <span class="PreProc">F</span><span class="Special">)</span> <span class="PreProc">T</span><span class="Special">)</span>
<span class="LineNr">35 </span>
<a name="interpreterenv"></a><span class="LineNr">36 </span>  <span class="Type">data</span> <span class="PreProc">Env</span> <span class="Statement">:</span> <span class="PreProc">Vect</span> n <span class="PreProc">Ty</span> <span class="Statement">-&gt;</span> <span class="PreProc">Type</span> <span class="Type">where</span>
<span class="LineNr">37 </span>    <span class="PreProc">Nil</span> <span class="Statement">:</span> <span class="PreProc">Env</span> <span class="Special">[]</span>
<span class="LineNr">38 </span>    <span class="Special">(</span><span class="Statement">::</span><span class="Special">)</span> <span class="Statement">:</span> typeOf t <span class="Statement">-&gt;</span> <span class="PreProc">Env</span> ctxt <span class="Statement">-&gt;</span> <span class="PreProc">Env</span> <span class="Special">(</span>t<span class="Statement">::</span>ctxt<span class="Special">)</span>
<span class="LineNr">39 </span>
<span class="LineNr">40 </span>  lookup <span class="Statement">:</span> <span class="Special">(</span>i <span class="Statement">:</span> <span class="PreProc">Fin</span> n<span class="Special">)</span> <span class="Statement">-&gt;</span> <span class="Special">(</span>env <span class="Statement">:</span> <span class="PreProc">Env</span> ctxt<span class="Special">)</span> <span class="Statement">-&gt;</span> typeOf <span class="Special">(</span>index i ctxt<span class="Special">)</span>
<span class="LineNr">41 </span>  lookup fZ <span class="Special">(</span>x <span class="Statement">::</span> y<span class="Special">)</span> <span class="Statement">=</span> x
<span class="LineNr">42 </span>  lookup <span class="Special">(</span>fS x<span class="Special">)</span> <span class="Special">(</span>y <span class="Statement">::</span> z<span class="Special">)</span> <span class="Statement">=</span> lookup x z
<span class="LineNr">43 </span>
<span class="LineNr">44 </span>  eval <span class="Statement">:</span> <span class="PreProc">Term</span> ctxt t <span class="Statement">-&gt;</span> <span class="PreProc">Env</span> ctxt <span class="Statement">-&gt;</span> typeOf t
<span class="LineNr">45 </span>  eval <span class="PreProc">T</span> env <span class="Statement">=</span> <span class="PreProc">True</span>
<span class="LineNr">46 </span>  eval <span class="PreProc">F</span> env <span class="Statement">=</span> <span class="PreProc">False</span>
<span class="LineNr">47 </span>  eval <span class="Special">(</span><span class="PreProc">IF</span> tm tm' tm''<span class="Special">)</span> env <span class="Statement">=</span> <span class="Statement">if</span> eval tm env <span class="Statement">then</span> eval tm' env <span class="Statement">else</span> eval tm'' env
<span class="LineNr">48 </span>  eval <span class="Special">(</span><span class="PreProc">App</span> f x<span class="Special">)</span> env <span class="Statement">=</span> <span class="Special">(</span>eval f env<span class="Special">)</span> <span class="Special">(</span>eval x env<span class="Special">)</span>
<span class="LineNr">49 </span>  eval <span class="Special">(</span><span class="PreProc">Lam</span> tm<span class="Special">)</span> env <span class="Statement">=</span> <span class="Statement">\</span> x <span class="Statement">=&gt;</span> eval tm <span class="Special">(</span>x <span class="Statement">::</span> env<span class="Special">)</span>
<span class="LineNr">50 </span>  eval <span class="Special">(</span><span class="PreProc">Var</span> i<span class="Special">)</span> env <span class="Statement">=</span> lookup i env
<span class="LineNr">51 </span>
<span class="LineNr">52 </span>
<span class="LineNr">53 </span>
</pre>
</div>
<canvas id="pdf" style="border: 1px solid black;"></canvas>
</div>
<script>
PDFJS.getDocument('idris.pdf').then(function(pdf) {
  pdfDoc = pdf;
  renderPage(1);
});
</script>
  </body>
</html>
